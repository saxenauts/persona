FROM python:3.12

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1

# Install poetry
RUN pip install poetry

WORKDIR /app

# Copy only the dependency files first to leverage Docker caching
COPY pyproject.toml poetry.lock ./

# Install dependencies (including dev) before copying the rest of the code
RUN poetry config virtualenvs.create false \
    && poetry install --no-root --with dev

# Copy the project files
COPY persona ./persona/
COPY server/ ./server/
COPY tests/ ./tests/

# Make the test runner script executable
RUN chmod +x tests/run_tests.sh

# Command to run our centralized test script
CMD ["tests/run_tests.sh"] 